<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resumen Transacciones Bancarias</title>
  <link rel="icon" href="img/d52f977512.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f4f6f8;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .contenedor-resumen {
      width: 100%;
      max-width: 500px;
      background-color: #ffffff;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .encabezado-resumen {
      background-color: #025BFF;
      text-align: center;
      padding: 25px 15px;
      color: white;
    }

    .encabezado-resumen h1 {
      font-size: 20px;
      letter-spacing: 1px;
    }

    .imagen-resumen {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 0;
    }

    .imagen-resumen img {
      width: 140px;
    }

    .resumen-transacciones {
      padding: 20px;
      font-size: 14px;
      color: #333;
      border-top: 1px solid #ccc;
    }

    .transaccion {
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .transaccion p {
      margin: 5px 0;
    }

    .botones-resumen {
      display: flex;
      justify-content: space-between;
      padding: 0 20px 20px;
    }

    .botones-resumen button {
      flex: 1;
      padding: 12px;
      margin: 0 5px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      background-color: #0b2961;
    }

    .botones-resumen button:hover {
      background-color: #2060d6;
    }

    .barra-interna-opciones {
      margin: 20px auto 1px;
      padding: 15px 10px;
      background-color: #025BFF;
      border-radius: 20px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      width: 100%;
    }

    .barra-interna-opciones .opcion {
      width: 70px;
      height: 70px;
      background-color: #e0e0e0;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform 0.2s ease;
    }

    .barra-interna-opciones .opcion:hover {
      transform: scale(1.05);
    }

    .barra-interna-opciones img {
      width: 36px;
      height: 36px;
    }

    @media print {

      .botones-resumen,
      .barra-interna-opciones {
        display: none;
      }
    }
  </style>
</head>

<body>
  <div id="contenedor-resumen" class="contenedor-resumen">
    <div class="encabezado-resumen">
      <h1>RESUMEN TRANSACCIONES</h1>
      <p id="nombreUsuario" style="margin-top: 10px; font-weight: bold;"></p>
      <p id="numeroCuenta" style="font-size: 14px;"></p>
    </div>

    <div class="imagen-resumen">
      <img src="img/transaccion (1).png" alt="TransacciÃ³n bancaria" />
    </div>

    <div class="resumen-transacciones" id="listaTransacciones">
      <p>Cargando transacciones...</p>
    </div>

    <div class="botones-resumen">
      <button id="botonimprimir1">IMPRIMIR</button>
      <button onclick="window.location.href='inicio.html'">CANCELAR</button>
    </div>

    <div class="barra-interna-opciones">
      <div class="opcion">
        <a href="Consignacion.html" title="Consignar">
          <img src="img/enviar-dinero.png" alt="Consignar" />
        </a>
      </div>
      <div class="opcion">
        <a href="inicio.html" title="Inicio">
          <img src="img/hogar.png" alt="Inicio" />
        </a>
      </div>
      <div class="opcion">
        <a href="Retiro.html" title="Retiro">
          <img src="img/retiro.png" alt="Retiro" />
        </a>
      </div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    doc,
    getDoc,
    getDocs,
    query,
    orderBy,
    limit
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAyVF_iOgpDKTQco5Y9ZqmURB0YAd6TMhs",
    authDomain: "acme-bank-a0686.firebaseapp.com",
    projectId: "acme-bank-a0686",
    storageBucket: "acme-bank-a0686.appspot.com",
    messagingSenderId: "302724149232",
    appId: "1:302724149232:web:9a84221b967416e2933735"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const identificacionUsuario = localStorage.getItem("identificacionUsuario");

  async function cargarDatosUsuario() {
    if (!identificacionUsuario) return;
    const docRef = doc(db, "usuarios", identificacionUsuario);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      const datos = docSnap.data();
      document.getElementById("nombreUsuario").textContent =
        datos.nombre?.toUpperCase() || "USUARIO";
      document.getElementById("numeroCuenta").textContent =
        `Cuenta: # ${datos.numeroCuenta || 'No disponible'}`;
    } else {
      document.getElementById("nombreUsuario").textContent = "USUARIO NO ENCONTRADO";
    }
  }

  async function cargarTransacciones() {
    const contenedor = document.getElementById("listaTransacciones");

    if (!identificacionUsuario) {
      contenedor.innerHTML = "<p>Usuario no identificado.</p>";
      return;
    }

    const transRef = collection(doc(db, "usuarios", identificacionUsuario), "transacciones");
    const q = query(transRef, orderBy("fecha", "desc"), limit(10));

    try {
      const snapshot = await getDocs(q);
      if (snapshot.empty) {
        contenedor.innerHTML = "<p>No hay transacciones registradas.</p>";
        return;
      }

      let html = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const fecha = typeof data.fecha === "string" ? data.fecha : "Fecha no disponible";
        html += `
          <div class="transaccion">
            <p><strong>Fecha:</strong> ${fecha}</p>
            <p><strong>Referencia:</strong> ${data.referencia}</p>
            <p><strong>Tipo:</strong> ${data.tipo}</p>
            <p><strong>Concepto:</strong> ${data.concepto}</p>
            <p><strong>Valor:</strong> $${data.valor.toLocaleString()}</p>
          </div>`;
      });

      contenedor.innerHTML = html;
    } catch (e) {
      console.error("Error obteniendo transacciones:", e);
      contenedor.innerHTML = "<p>Error cargando transacciones.</p>";
    }
  }

  document.getElementById("botonimprimir1").addEventListener("click", () => {
    window.print();
  });

  cargarDatosUsuario();
  cargarTransacciones();
</script>

</body>

</html>